{"version":3,"sources":["turbopack:///[project]/contexts/currency-context.tsx","turbopack:///[project]/contexts/data-context.tsx","turbopack:///[project]/lib/storage.ts"],"sourcesContent":["\"use client\"\n\nimport { createContext, useContext, type ReactNode } from \"react\"\n\ntype Currency = \"USD\"\n\ninterface CurrencyContextType {\n  currency: Currency\n  setCurrency: (currency: Currency) => void\n  formatPrice: (price: number) => string\n  convertPrice: (priceUSD: number) => number\n}\n\nconst CurrencyContext = createContext<CurrencyContextType | undefined>(undefined)\n\nexport function CurrencyProvider({ children }: { children: ReactNode }) {\n  const currency: Currency = \"USD\"\n\n  const setCurrency = (newCurrency: Currency) => {\n    // No-op, always USD\n  }\n\n  const convertPrice = (priceUSD: number): number => {\n    return priceUSD\n  }\n\n  const formatPrice = (priceUSD: number): string => {\n    return `$${priceUSD.toFixed(2)}`\n  }\n\n  return (\n    <CurrencyContext.Provider value={{ currency, setCurrency, formatPrice, convertPrice }}>\n      {children}\n    </CurrencyContext.Provider>\n  )\n}\n\nexport function useCurrency() {\n  const context = useContext(CurrencyContext)\n  if (!context) {\n    throw new Error(\"useCurrency must be used within CurrencyProvider\")\n  }\n  return context\n}\n","\"use client\"\n\nimport { createContext, useContext, useState, useEffect, type ReactNode } from \"react\"\nimport type { Server, Transaction, PromoCode, Referral, SupportTicket } from \"@/lib/types\"\nimport { storage, KEYS } from \"@/lib/storage\"\nimport { useAuth } from \"./auth-context\"\nimport { useToast } from \"@/hooks/use-toast\"\n\ninterface DataContextType {\n  servers: Server[]\n  transactions: Transaction[]\n  promoCodes: PromoCode[]\n  referrals: Referral[]\n  supportTickets: SupportTicket[]\n  createServer: (server: Omit<Server, \"id\" | \"userId\" | \"createdAt\">) => void\n  deleteServer: (serverId: string) => void\n  updateServer: (serverId: string, updates: Partial<Server>) => void\n  addTransaction: (transaction: Omit<Transaction, \"id\" | \"createdAt\">) => void\n  createPromoCode: (promoCode: Omit<PromoCode, \"id\" | \"currentUses\">) => void\n  applyPromoCode: (code: string, amount: number) => number\n  createSupportTicket: (ticket: Omit<SupportTicket, \"id\" | \"createdAt\" | \"updatedAt\">) => void\n  refreshData: () => void\n}\n\nconst DataContext = createContext<DataContextType | undefined>(undefined)\n\nexport function DataProvider({ children }: { children: ReactNode }) {\n  const { user, updateUser } = useAuth()\n  const { toast } = useToast()\n  const [servers, setServers] = useState<Server[]>([])\n  const [transactions, setTransactions] = useState<Transaction[]>([])\n  const [promoCodes, setPromoCodes] = useState<PromoCode[]>([])\n  const [referrals, setReferrals] = useState<Referral[]>([])\n  const [supportTickets, setSupportTickets] = useState<SupportTicket[]>([])\n\n  const loadData = () => {\n    setServers(storage.get<Server[]>(KEYS.SERVERS) || [])\n    setTransactions(storage.get<Transaction[]>(KEYS.TRANSACTIONS) || [])\n    setPromoCodes(storage.get<PromoCode[]>(KEYS.PROMO_CODES) || [])\n    setReferrals(storage.get<Referral[]>(KEYS.REFERRALS) || [])\n    setSupportTickets(storage.get<SupportTicket[]>(KEYS.SUPPORT_TICKETS) || [])\n  }\n\n  useEffect(() => {\n    loadData()\n  }, [])\n\n  const createServer = (serverData: Omit<Server, \"id\" | \"userId\" | \"createdAt\">) => {\n    if (!user) return\n\n    const newServer: Server = {\n      ...serverData,\n      id: generateId(),\n      userId: user.id,\n      createdAt: new Date().toISOString(),\n    }\n\n    const updatedServers = [...servers, newServer]\n    setServers(updatedServers)\n    storage.set(KEYS.SERVERS, updatedServers)\n\n    // Deduct from balance\n    updateUser({ balance: user.balance - serverData.price })\n\n    // Add transaction\n    addTransaction({\n      userId: user.id,\n      type: \"purchase\",\n      amount: -serverData.price,\n      status: \"completed\",\n      description: `Purchased server: ${serverData.name}`,\n    })\n\n    toast({\n      title: \"Сервер создан!\",\n      description: `Сервер ${serverData.name} успешно создан`,\n    })\n  }\n\n  const deleteServer = (serverId: string) => {\n    const updatedServers = servers.filter((s) => s.id !== serverId)\n    setServers(updatedServers)\n    storage.set(KEYS.SERVERS, updatedServers)\n\n    toast({\n      title: \"Сервер удален\",\n      description: \"Сервер успешно удален\",\n    })\n  }\n\n  const updateServer = (serverId: string, updates: Partial<Server>) => {\n    const updatedServers = servers.map((s) => (s.id === serverId ? { ...s, ...updates } : s))\n    setServers(updatedServers)\n    storage.set(KEYS.SERVERS, updatedServers)\n  }\n\n  const addTransaction = (transactionData: Omit<Transaction, \"id\" | \"createdAt\">) => {\n    const newTransaction: Transaction = {\n      ...transactionData,\n      id: generateId(),\n      createdAt: new Date().toISOString(),\n    }\n\n    const updatedTransactions = [...transactions, newTransaction]\n    setTransactions(updatedTransactions)\n    storage.set(KEYS.TRANSACTIONS, updatedTransactions)\n\n    // Handle referral commission\n    if (transactionData.type === \"topup\" && transactionData.status === \"completed\" && user) {\n      const userReferrals = referrals.filter((r) => r.referredId === user.id)\n      if (userReferrals.length > 0) {\n        const commission = transactionData.amount * 0.1\n        const referral = userReferrals[0]\n\n        // Update referral earnings\n        const updatedReferrals = referrals.map((r) =>\n          r.id === referral.id ? { ...r, earnings: r.earnings + commission } : r,\n        )\n        setReferrals(updatedReferrals)\n        storage.set(KEYS.REFERRALS, updatedReferrals)\n      }\n    }\n  }\n\n  const createPromoCode = (promoCodeData: Omit<PromoCode, \"id\" | \"currentUses\">) => {\n    const newPromoCode: PromoCode = {\n      ...promoCodeData,\n      id: generateId(),\n      currentUses: 0,\n    }\n\n    const updatedPromoCodes = [...promoCodes, newPromoCode]\n    setPromoCodes(updatedPromoCodes)\n    storage.set(KEYS.PROMO_CODES, updatedPromoCodes)\n\n    toast({\n      title: \"Промокод создан\",\n      description: `Промокод ${promoCodeData.code} успешно создан`,\n    })\n  }\n\n  const applyPromoCode = (code: string, amount: number): number => {\n    const promoCode = promoCodes.find(\n      (p) => p.code === code && p.active && p.currentUses < p.maxUses && new Date(p.expiresAt) > new Date(),\n    )\n\n    if (!promoCode) {\n      toast({\n        title: \"Ошибка\",\n        description: \"Промокод недействителен или истек\",\n        variant: \"destructive\",\n      })\n      return amount\n    }\n\n    // Update promo code usage\n    const updatedPromoCodes = promoCodes.map((p) =>\n      p.id === promoCode.id ? { ...p, currentUses: p.currentUses + 1 } : p,\n    )\n    setPromoCodes(updatedPromoCodes)\n    storage.set(KEYS.PROMO_CODES, updatedPromoCodes)\n\n    const discount = promoCode.type === \"percentage\" ? amount * (promoCode.discount / 100) : promoCode.discount\n\n    toast({\n      title: \"Промокод применен!\",\n      description: `Скидка: ${discount.toFixed(2)}$`,\n    })\n\n    return amount - discount\n  }\n\n  const createSupportTicket = (ticketData: Omit<SupportTicket, \"id\" | \"createdAt\" | \"updatedAt\">) => {\n    if (!user) return\n\n    const newTicket: SupportTicket = {\n      ...ticketData,\n      id: generateId(),\n      userId: user.id,\n      createdAt: new Date().toISOString(),\n      updatedAt: new Date().toISOString(),\n    }\n\n    const updatedTickets = [...supportTickets, newTicket]\n    setSupportTickets(updatedTickets)\n    storage.set(KEYS.SUPPORT_TICKETS, updatedTickets)\n\n    toast({\n      title: \"Тикет создан\",\n      description: \"Ваш запрос отправлен в поддержку\",\n    })\n  }\n\n  const refreshData = () => {\n    loadData()\n  }\n\n  return (\n    <DataContext.Provider\n      value={{\n        servers,\n        transactions,\n        promoCodes,\n        referrals,\n        supportTickets,\n        createServer,\n        deleteServer,\n        updateServer,\n        addTransaction,\n        createPromoCode,\n        applyPromoCode,\n        createSupportTicket,\n        refreshData,\n      }}\n    >\n      {children}\n    </DataContext.Provider>\n  )\n}\n\nexport function useData() {\n  const context = useContext(DataContext)\n  if (context === undefined) {\n    throw new Error(\"useData must be used within a DataProvider\")\n  }\n  return context\n}\n\nfunction generateId(): string {\n  return `${Date.now()}-${Math.random().toString(36).substr(2, 9)}`\n}\n","// Local storage utilities for data persistence\nconst STORAGE_KEYS = {\n  USER: \"vds_hub_user\",\n  USERS: \"vds_hub_users\",\n  SERVERS: \"vds_hub_servers\",\n  TRANSACTIONS: \"vds_hub_transactions\",\n  ACTIVITY_LOGS: \"vds_hub_activity_logs\",\n  PROMO_CODES: \"vds_hub_promo_codes\",\n  REFERRALS: \"vds_hub_referrals\",\n  SUPPORT_TICKETS: \"vds_hub_support_tickets\",\n}\n\nexport const storage = {\n  get: (key: string): any | null => {\n    if (typeof window === \"undefined\") return null\n    const item = localStorage.getItem(key)\n    return item ? JSON.parse(item) : null\n  },\n\n  set: (key: string, value: any): void => {\n    if (typeof window === \"undefined\") return\n    localStorage.setItem(key, JSON.stringify(value))\n  },\n\n  remove: (key: string): void => {\n    if (typeof window === \"undefined\") return\n    localStorage.removeItem(key)\n  },\n\n  clear: (): void => {\n    if (typeof window === \"undefined\") return\n    localStorage.clear()\n  },\n}\n\nexport const KEYS = STORAGE_KEYS\n"],"names":[],"mappings":"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"}