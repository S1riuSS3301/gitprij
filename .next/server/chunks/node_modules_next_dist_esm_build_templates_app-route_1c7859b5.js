module.exports=[35127,e=>{"use strict";var t=e.i(47909),r=e.i(74017),a=e.i(96250),s=e.i(59756),n=e.i(61916),o=e.i(14444),i=e.i(10680),d=e.i(69741),l=e.i(16795),u=e.i(87718),c=e.i(95169),p=e.i(47587),h=e.i(66012),v=e.i(70101),f=e.i(26937),m=e.i(10372),w=e.i(93695);e.i(52474);var R=e.i(220),g=e.i(89171),y=e.i(12530);e.i(81579);var x=e.i(88697),E=e.i(5853);let N=process.env.VMMANAGER_URL,I=process.env.VMMANAGER_API_KEY,S=process.env.VMMANAGER_CLUSTER_ID||"1";async function b(e,t="GET",r){let a=`${N}${e}`,s={method:t,headers:{"Content-Type":"application/json",Authorization:`Bearer ${I}`}};r&&(s.body=JSON.stringify(r));try{let e=await fetch(a,s);if(!e.ok)throw Error(`VMmanager API error: ${e.status} ${e.statusText}`);return await e.json()}catch(e){throw console.error("VMmanager API call failed:",e),e}}async function A(){return(await b("/vm/v3/os")).map(e=>({id:e.id,name:e.name,family:e.family||"linux"}))}async function C({plan:e,osId:t,userId:r,installPython:a,pythonVersion:s,installGoogleSDK:n}){let o=`vds-${r}-${Date.now()}`,i=function(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&*",t="";for(let r=0;r<16;r++)t+=e.charAt(Math.floor(Math.random()*e.length));return t}(),d="";a&&(d+=`curl -fsSL https://deb.nodesource.com/setup_current.x | sudo -E bash -
sudo apt-get install -y nodejs npm
`,s?d+=`sudo apt-get install -y python${s} python${s}-pip
`:d+=`sudo apt-get install -y python3 python3-pip
`),n&&(d+=`curl -fsSL https://sdk.cloud.google.com | bash
exec -l $SHELL
`);let l={name:o,os_id:t,cpu:e.cpu,ram:1024*e.ram,storage:1024*e.storage,password:i,post_install_script:d||void 0},u=await b(`/vm/v3/cluster/${S}/vm`,"POST",l);return{success:!0,vmId:u.id,serverName:u.name,ip:u.ip||"Pending",password:i,os:t,specs:{cpu:e.cpu,ram:e.ram,storage:e.storage}}}async function P(e){return await b(`/vm/v3/vm/${e}/action`,"POST",{action:"reboot"}),{success:!0}}async function T(e){return await b(`/vm/v3/vm/${e}/action`,"POST",{action:"poweroff"}),{success:!0}}async function j(e,t){return await b(`/vm/v3/vm/${e}`,"PUT",{password:t}),{success:!0}}async function U(e,t){return await b(`/vm/v3/vm/${e}`,"PUT",{os_id:t}),{success:!0}}async function _(e){let t=await (0,y.getAuthUser)();if(!t)return g.NextResponse.json({error:"Unauthorized"},{status:401});let{searchParams:r}=new URL(e.url),a=r.get("action");if("servers"===a){let e=await x.db.order.findMany({where:{userId:t.userId,status:"active"},include:{serverPlan:!0}});return g.NextResponse.json(e)}if("os"===a)try{let e=await A();return g.NextResponse.json(e)}catch(e){return console.error("Failed to get OS list:",e),g.NextResponse.json({error:"Failed to get OS list"},{status:500})}return g.NextResponse.json({error:"Invalid action"},{status:400})}async function O(e){let t=await (0,y.getAuthUser)();if(!t)return g.NextResponse.json({error:"Unauthorized"},{status:401});let{action:r,orderId:a,osId:s,installPython:n,pythonVersion:o,installGoogleSDK:i}=await e.json();if("create_server"===r){let e=await x.db.order.findUnique({where:{id:a,userId:t.userId},include:{serverPlan:!0}});if(!e||"active"!==e.status)return g.NextResponse.json({error:"Order not found or not active"},{status:404});let r=await C({plan:e.serverPlan,osId:s,userId:t.userId,installPython:n,pythonVersion:o,installGoogleSDK:i});if(!r.success)return g.NextResponse.json({error:"Failed to create server"},{status:500});{await x.db.order.update({where:{id:a},data:{serverName:r.serverName,vmId:r.vmId,ip:r.ip,password:r.password,os:r.os}});let e=await x.db.user.findUnique({where:{id:t.userId},select:{email:!0,name:!0}});if(e?.email)try{await E.resend.emails.send({from:"noreply@vds-hub.com",to:e.email,subject:"Your VDS Server is Ready!",html:`
              <h1>Server Created Successfully!</h1>
              <p>Dear ${e.name||"User"},</p>
              <p>Your VDS server has been created and is ready to use.</p>
              <h2>Server Details:</h2>
              <ul>
                <li><strong>IP Address:</strong> ${r.ip}</li>
                <li><strong>Password:</strong> ${r.password}</li>
                <li><strong>OS:</strong> ${r.os}</li>
                <li><strong>CPU:</strong> ${r.specs.cpu} cores</li>
                <li><strong>RAM:</strong> ${r.specs.ram} GB</li>
                <li><strong>Storage:</strong> ${r.specs.storage} GB</li>
              </ul>
              <p>Please save these credentials securely. You can change the password later.</p>
              <br>
              <p>Best regards,<br>VDS Hub Team</p>
            `})}catch(e){console.error("Failed to send server email:",e)}return g.NextResponse.json({success:!0,server:r})}}if("reboot"===r){let e=await x.db.order.findUnique({where:{id:a,userId:t.userId}});if(!e||!e.vmId)return g.NextResponse.json({error:"Server not found or not created yet"},{status:404});try{let t=await P(e.vmId);return g.NextResponse.json(t)}catch(e){return console.error("Reboot failed:",e),g.NextResponse.json({error:"Failed to reboot server"},{status:500})}}if("power_off"===r){let e=await x.db.order.findUnique({where:{id:a,userId:t.userId}});if(!e||!e.vmId)return g.NextResponse.json({error:"Server not found or not created yet"},{status:404});try{let t=await T(e.vmId);return g.NextResponse.json(t)}catch(e){return console.error("Power off failed:",e),g.NextResponse.json({error:"Failed to power off server"},{status:500})}}if("change_password"===r){let{newPassword:r}=await e.json(),s=await x.db.order.findUnique({where:{id:a,userId:t.userId}});if(!s||!s.vmId)return g.NextResponse.json({error:"Server not found or not created yet"},{status:404});try{let e=await j(s.vmId,r);return await x.db.order.update({where:{id:a},data:{password:r}}),g.NextResponse.json(e)}catch(e){return console.error("Change password failed:",e),g.NextResponse.json({error:"Failed to change password"},{status:500})}}if("change_os"===r){let e=await x.db.order.findUnique({where:{id:a,userId:t.userId}});if(!e||!e.vmId)return g.NextResponse.json({error:"Server not found or not created yet"},{status:404});try{let t=await U(e.vmId,s);return await x.db.order.update({where:{id:a},data:{os:s}}),g.NextResponse.json(t)}catch(e){return console.error("Change OS failed:",e),g.NextResponse.json({error:"Failed to change OS"},{status:500})}}return g.NextResponse.json({error:"Invalid action"},{status:400})}e.s(["GET",()=>_,"POST",()=>O],3048);var $=e.i(3048);let M=new t.AppRouteRouteModule({definition:{kind:r.RouteKind.APP_ROUTE,page:"/api/vmmanager/route",pathname:"/api/vmmanager",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/app/api/vmmanager/route.ts",nextConfigOutput:"",userland:$}),{workAsyncStorage:q,workUnitAsyncStorage:D,serverHooks:H}=M;function F(){return(0,a.patchFetch)({workAsyncStorage:q,workUnitAsyncStorage:D})}async function k(e,t,a){M.isDev&&(0,s.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let g="/api/vmmanager/route";g=g.replace(/\/index$/,"")||"/";let y=await M.prepare(e,t,{srcPage:g,multiZoneDraftMode:!1});if(!y)return t.statusCode=400,t.end("Bad Request"),null==a.waitUntil||a.waitUntil.call(a,Promise.resolve()),null;let{buildId:x,params:E,nextConfig:N,parsedUrl:I,isDraftMode:S,prerenderManifest:b,routerServerContext:A,isOnDemandRevalidate:C,revalidateOnlyGenerated:P,resolvedPathname:T,clientReferenceManifest:j,serverActionsManifest:U}=y,_=(0,d.normalizeAppPath)(g),O=!!(b.dynamicRoutes[_]||b.routes[T]),$=async()=>((null==A?void 0:A.render404)?await A.render404(e,t,I,!1):t.end("This page could not be found"),null);if(O&&!S){let e=!!b.routes[T],t=b.dynamicRoutes[_];if(t&&!1===t.fallback&&!e){if(N.experimental.adapterPath)return await $();throw new w.NoFallbackError}}let q=null;!O||M.isDev||S||(q="/index"===(q=T)?"/":q);let D=!0===M.isDev||!O,H=O&&!D;U&&j&&(0,o.setReferenceManifestsSingleton)({page:g,clientReferenceManifest:j,serverActionsManifest:U,serverModuleMap:(0,i.createServerModuleMap)({serverActionsManifest:U})});let F=e.method||"GET",k=(0,n.getTracer)(),L=k.getActiveScopeSpan(),V={params:E,prerenderManifest:b,renderOpts:{experimental:{authInterrupts:!!N.experimental.authInterrupts},cacheComponents:!!N.cacheComponents,supportsDynamicResponse:D,incrementalCache:(0,s.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:N.cacheLife,waitUntil:a.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,a)=>M.onRequestError(e,t,a,A)},sharedContext:{buildId:x}},G=new l.NodeNextRequest(e),B=new l.NodeNextResponse(t),K=u.NextRequestAdapter.fromNodeNextRequest(G,(0,u.signalFromNodeResponse)(t));try{let o=async e=>M.handle(K,V).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=k.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==c.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let a=r.get("next.route");if(a){let t=`${F} ${a}`;e.setAttributes({"next.route":a,"http.route":a,"next.span_name":t}),e.updateName(t)}else e.updateName(`${F} ${g}`)}),i=!!(0,s.getRequestMeta)(e,"minimalMode"),d=async s=>{var n,d;let l=async({previousCacheEntry:r})=>{try{if(!i&&C&&P&&!r)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let n=await o(s);e.fetchMetrics=V.renderOpts.fetchMetrics;let d=V.renderOpts.pendingWaitUntil;d&&a.waitUntil&&(a.waitUntil(d),d=void 0);let l=V.renderOpts.collectedTags;if(!O)return await (0,h.sendResponse)(G,B,n,V.renderOpts.pendingWaitUntil),null;{let e=await n.blob(),t=(0,v.toNodeOutgoingHttpHeaders)(n.headers);l&&(t[m.NEXT_CACHE_TAGS_HEADER]=l),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==V.renderOpts.collectedRevalidate&&!(V.renderOpts.collectedRevalidate>=m.INFINITE_CACHE)&&V.renderOpts.collectedRevalidate,a=void 0===V.renderOpts.collectedExpire||V.renderOpts.collectedExpire>=m.INFINITE_CACHE?void 0:V.renderOpts.collectedExpire;return{value:{kind:R.CachedRouteKind.APP_ROUTE,status:n.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:a}}}}catch(t){throw(null==r?void 0:r.isStale)&&await M.onRequestError(e,t,{routerKind:"App Router",routePath:g,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:H,isOnDemandRevalidate:C})},A),t}},u=await M.handleResponse({req:e,nextConfig:N,cacheKey:q,routeKind:r.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:b,isRoutePPREnabled:!1,isOnDemandRevalidate:C,revalidateOnlyGenerated:P,responseGenerator:l,waitUntil:a.waitUntil,isMinimalMode:i});if(!O)return null;if((null==u||null==(n=u.value)?void 0:n.kind)!==R.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==u||null==(d=u.value)?void 0:d.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});i||t.setHeader("x-nextjs-cache",C?"REVALIDATED":u.isMiss?"MISS":u.isStale?"STALE":"HIT"),S&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let c=(0,v.fromNodeOutgoingHttpHeaders)(u.value.headers);return i&&O||c.delete(m.NEXT_CACHE_TAGS_HEADER),!u.cacheControl||t.getHeader("Cache-Control")||c.get("Cache-Control")||c.set("Cache-Control",(0,f.getCacheControlHeader)(u.cacheControl)),await (0,h.sendResponse)(G,B,new Response(u.value.body,{headers:c,status:u.value.status||200})),null};L?await d(L):await k.withPropagatedContext(e.headers,()=>k.trace(c.BaseServerSpan.handleRequest,{spanName:`${F} ${g}`,kind:n.SpanKind.SERVER,attributes:{"http.method":F,"http.target":e.url}},d))}catch(t){if(t instanceof w.NoFallbackError||await M.onRequestError(e,t,{routerKind:"App Router",routePath:_,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:H,isOnDemandRevalidate:C})}),O)throw t;return await (0,h.sendResponse)(G,B,new Response(null,{status:500})),null}}e.s(["handler",()=>k,"patchFetch",()=>F,"routeModule",()=>M,"serverHooks",()=>H,"workAsyncStorage",()=>q,"workUnitAsyncStorage",()=>D],35127)}];

//# sourceMappingURL=node_modules_next_dist_esm_build_templates_app-route_1c7859b5.js.map