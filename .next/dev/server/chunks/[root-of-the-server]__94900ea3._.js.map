{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/saefs/Downloads/vds-hub/vds-hub/lib/prisma.ts"],"sourcesContent":["import { PrismaClient } from \"@prisma/client\"\r\n\r\ndeclare global {\r\n  // eslint-disable-next-line no-var\r\n  var prisma: PrismaClient | undefined\r\n}\r\n\r\nexport const prisma: PrismaClient = global.prisma ?? new PrismaClient()\r\n\r\nif (process.env.NODE_ENV !== \"production\") {\r\n  global.prisma = prisma\r\n}\r\n\r\n\r\n"],"names":[],"mappings":";;;;AAAA;;AAOO,MAAM,SAAuB,OAAO,MAAM,IAAI,IAAI,6IAAY;AAErE,wCAA2C;IACzC,OAAO,MAAM,GAAG;AAClB","debugId":null}},
    {"offset": {"line": 72, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/saefs/Downloads/vds-hub/vds-hub/lib/jwt.ts"],"sourcesContent":["import { SignJWT, jwtVerify } from \"jose\"\n\nconst JWT_SECRET = new TextEncoder().encode(process.env.JWT_SECRET || \"your-secret-key-change-in-production\")\nconst JWT_EXPIRES_IN = \"7d\"\n\nexport interface JWTPayload {\n  userId: string\n  email: string\n  role: string\n}\n\nexport async function signToken(payload: JWTPayload): Promise<string> {\n  return await new SignJWT(payload)\n    .setProtectedHeader({ alg: \"HS256\" })\n    .setIssuedAt()\n    .setExpirationTime(JWT_EXPIRES_IN)\n    .sign(JWT_SECRET)\n}\n\nexport async function verifyToken(token: string): Promise<JWTPayload | null> {\n  try {\n    const { payload } = await jwtVerify(token, JWT_SECRET)\n    return payload as JWTPayload\n  } catch (error) {\n    return null\n  }\n}\n"],"names":[],"mappings":";;;;;;AAAA;AAAA;;AAEA,MAAM,aAAa,IAAI,cAAc,MAAM,CAAC,QAAQ,GAAG,CAAC,UAAU,IAAI;AACtE,MAAM,iBAAiB;AAQhB,eAAe,UAAU,OAAmB;IACjD,OAAO,MAAM,IAAI,2MAAO,CAAC,SACtB,kBAAkB,CAAC;QAAE,KAAK;IAAQ,GAClC,WAAW,GACX,iBAAiB,CAAC,gBAClB,IAAI,CAAC;AACV;AAEO,eAAe,YAAY,KAAa;IAC7C,IAAI;QACF,MAAM,EAAE,OAAO,EAAE,GAAG,MAAM,IAAA,+MAAS,EAAC,OAAO;QAC3C,OAAO;IACT,EAAE,OAAO,OAAO;QACd,OAAO;IACT;AACF","debugId":null}},
    {"offset": {"line": 100, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/saefs/Downloads/vds-hub/vds-hub/lib/db.ts"],"sourcesContent":["export { prisma as db } from \"./prisma\"\n"],"names":[],"mappings":";AAAA","debugId":null}},
    {"offset": {"line": 116, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/saefs/Downloads/vds-hub/vds-hub/lib/auth-utils.ts"],"sourcesContent":["import bcrypt from \"bcryptjs\"\nimport { cookies } from \"next/headers\"\nimport { verifyToken, type JWTPayload } from \"./jwt\"\nimport { db } from \"./db\"\n\nconst SALT_ROUNDS = 10\n\nexport async function hashPassword(password: string): Promise<string> {\n  return bcrypt.hash(password, SALT_ROUNDS)\n}\n\nexport async function comparePassword(password: string, hash: string): Promise<boolean> {\n  return bcrypt.compare(password, hash)\n}\n\nexport async function getAuthUser(): Promise<JWTPayload | null> {\n  const cookieStore = await cookies()\n  const token = cookieStore.get(\"auth-token\")?.value\n\n  if (!token) return null\n\n  return verifyToken(token)\n}\n\nexport async function getUser() {\n  const authUser = await getAuthUser()\n  if (!authUser) return null\n\n  const user = await db.user.findUnique({\n    where: { id: authUser.userId },\n    include: { profile: true },\n  })\n\n  return user\n}\n\nexport async function setAuthCookie(token: string): Promise<void> {\n  const cookieStore = await cookies()\n  cookieStore.set(\"auth-token\", token, {\n    httpOnly: true,\n    secure: process.env.NODE_ENV === \"production\",\n    sameSite: \"lax\",\n    maxAge: 60 * 60 * 24 * 7, // 7 days\n    path: \"/\",\n  })\n}\n\nexport async function clearAuthCookie(): Promise<void> {\n  const cookieStore = await cookies()\n  cookieStore.delete(\"auth-token\")\n}\n"],"names":[],"mappings":";;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AAAA;;;;;AAEA,MAAM,cAAc;AAEb,eAAe,aAAa,QAAgB;IACjD,OAAO,uLAAM,CAAC,IAAI,CAAC,UAAU;AAC/B;AAEO,eAAe,gBAAgB,QAAgB,EAAE,IAAY;IAClE,OAAO,uLAAM,CAAC,OAAO,CAAC,UAAU;AAClC;AAEO,eAAe;IACpB,MAAM,cAAc,MAAM,IAAA,qLAAO;IACjC,MAAM,QAAQ,YAAY,GAAG,CAAC,eAAe;IAE7C,IAAI,CAAC,OAAO,OAAO;IAEnB,OAAO,IAAA,oKAAW,EAAC;AACrB;AAEO,eAAe;IACpB,MAAM,WAAW,MAAM;IACvB,IAAI,CAAC,UAAU,OAAO;IAEtB,MAAM,OAAO,MAAM,8LAAE,CAAC,IAAI,CAAC,UAAU,CAAC;QACpC,OAAO;YAAE,IAAI,SAAS,MAAM;QAAC;QAC7B,SAAS;YAAE,SAAS;QAAK;IAC3B;IAEA,OAAO;AACT;AAEO,eAAe,cAAc,KAAa;IAC/C,MAAM,cAAc,MAAM,IAAA,qLAAO;IACjC,YAAY,GAAG,CAAC,cAAc,OAAO;QACnC,UAAU;QACV,QAAQ,oDAAyB;QACjC,UAAU;QACV,QAAQ,KAAK,KAAK,KAAK;QACvB,MAAM;IACR;AACF;AAEO,eAAe;IACpB,MAAM,cAAc,MAAM,IAAA,qLAAO;IACjC,YAAY,MAAM,CAAC;AACrB","debugId":null}},
    {"offset": {"line": 183, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/saefs/Downloads/vds-hub/vds-hub/app/api/lzt/create/route.ts"],"sourcesContent":["import { NextResponse } from 'next/server'\r\nimport { prisma } from '@/lib/prisma'\r\nimport { getAuthUser } from '@/lib/auth-utils'\r\n\r\nexport async function POST(request: Request) {\r\n  try {\r\n    const auth = await getAuthUser()\r\n    if (!auth) return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })\r\n    const { amount, description = 'Пополнение через LZT', currency = 'USD' } = await request.json()\r\n\r\n    const parsed = Number.parseFloat(amount)\r\n    if (isNaN(parsed) || parsed < 10) {\r\n      return NextResponse.json({ error: 'Некорректные параметры' }, { status: 400 })\r\n    }\r\n\r\n    // создаём pending транзакцию с методом lzt\r\n    const tx = await prisma.transaction.create({\r\n      data: {\r\n        userId: auth.userId,\r\n        amount: parsed,\r\n        currency,\r\n        method: 'lzt',\r\n        status: 'pending',\r\n      },\r\n    })\r\n\r\n    // Внешний вызов LZT API (опционально)\r\n    const apiUrl = process.env.LZT_API_URL\r\n    let payUrl: string | null = null\r\n    if (apiUrl) {\r\n      try {\r\n        const payload = {\r\n          amount: parsed,\r\n          description,\r\n          additional_data: JSON.stringify({ userId: auth.userId, payment_id: tx.id }),\r\n          currency,\r\n        }\r\n        const res = await fetch(apiUrl, {\r\n          method: 'POST',\r\n          headers: { 'Content-Type': 'application/json', 'x-secret-key': process.env.LZT_MERCHANT_SECRET || '' },\r\n          body: JSON.stringify(payload),\r\n        })\r\n        const data = await res.json().catch(() => ({}))\r\n        if (res.ok && (data?.url || data?.pay_url)) {\r\n          payUrl = data.url || data.pay_url\r\n        }\r\n      } catch {}\r\n    }\r\n\r\n    if (!payUrl) {\r\n      // Фоллбек: отдаём фейковую страницу оплаты, чтобы не блокировать UX\r\n      payUrl = `/dashboard/billing?tx=${tx.id}`\r\n    }\r\n\r\n    return NextResponse.json({ url: payUrl, id: tx.id })\r\n  } catch (e: any) {\r\n    return NextResponse.json({ error: e.message }, { status: 500 })\r\n  }\r\n}\r\n\r\n\r\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;AAEO,eAAe,KAAK,OAAgB;IACzC,IAAI;QACF,MAAM,OAAO,MAAM,IAAA,8KAAW;QAC9B,IAAI,CAAC,MAAM,OAAO,yLAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAe,GAAG;YAAE,QAAQ;QAAI;QAC7E,MAAM,EAAE,MAAM,EAAE,cAAc,sBAAsB,EAAE,WAAW,KAAK,EAAE,GAAG,MAAM,QAAQ,IAAI;QAE7F,MAAM,SAAS,OAAO,UAAU,CAAC;QACjC,IAAI,MAAM,WAAW,SAAS,IAAI;YAChC,OAAO,yLAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAyB,GAAG;gBAAE,QAAQ;YAAI;QAC9E;QAEA,2CAA2C;QAC3C,MAAM,KAAK,MAAM,kKAAM,CAAC,WAAW,CAAC,MAAM,CAAC;YACzC,MAAM;gBACJ,QAAQ,KAAK,MAAM;gBACnB,QAAQ;gBACR;gBACA,QAAQ;gBACR,QAAQ;YACV;QACF;QAEA,sCAAsC;QACtC,MAAM,SAAS,QAAQ,GAAG,CAAC,WAAW;QACtC,IAAI,SAAwB;QAC5B,IAAI,QAAQ;YACV,IAAI;gBACF,MAAM,UAAU;oBACd,QAAQ;oBACR;oBACA,iBAAiB,KAAK,SAAS,CAAC;wBAAE,QAAQ,KAAK,MAAM;wBAAE,YAAY,GAAG,EAAE;oBAAC;oBACzE;gBACF;gBACA,MAAM,MAAM,MAAM,MAAM,QAAQ;oBAC9B,QAAQ;oBACR,SAAS;wBAAE,gBAAgB;wBAAoB,gBAAgB,QAAQ,GAAG,CAAC,mBAAmB,IAAI;oBAAG;oBACrG,MAAM,KAAK,SAAS,CAAC;gBACvB;gBACA,MAAM,OAAO,MAAM,IAAI,IAAI,GAAG,KAAK,CAAC,IAAM,CAAC,CAAC,CAAC;gBAC7C,IAAI,IAAI,EAAE,IAAI,CAAC,MAAM,OAAO,MAAM,OAAO,GAAG;oBAC1C,SAAS,KAAK,GAAG,IAAI,KAAK,OAAO;gBACnC;YACF,EAAE,OAAM,CAAC;QACX;QAEA,IAAI,CAAC,QAAQ;YACX,oEAAoE;YACpE,SAAS,CAAC,sBAAsB,EAAE,GAAG,EAAE,EAAE;QAC3C;QAEA,OAAO,yLAAY,CAAC,IAAI,CAAC;YAAE,KAAK;YAAQ,IAAI,GAAG,EAAE;QAAC;IACpD,EAAE,OAAO,GAAQ;QACf,OAAO,yLAAY,CAAC,IAAI,CAAC;YAAE,OAAO,EAAE,OAAO;QAAC,GAAG;YAAE,QAAQ;QAAI;IAC/D;AACF","debugId":null}}]
}