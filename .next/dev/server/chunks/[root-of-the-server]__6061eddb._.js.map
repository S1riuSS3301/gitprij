{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///Users/daniilapet/Downloads/_next/lib/prisma.ts"],"sourcesContent":["import { PrismaClient } from \"@prisma/client\"\r\n\r\ndeclare global {\r\n  // eslint-disable-next-line no-var\r\n  var prisma: PrismaClient | undefined\r\n}\r\n\r\nexport const prisma: PrismaClient = global.prisma ?? new PrismaClient()\r\n\r\nif (process.env.NODE_ENV !== \"production\") {\r\n  global.prisma = prisma\r\n}\r\n\r\n\r\n"],"names":[],"mappings":";;;;AAAA;;AAOO,MAAM,SAAuB,OAAO,MAAM,IAAI,IAAI,6IAAY;AAErE,wCAA2C;IACzC,OAAO,MAAM,GAAG;AAClB","debugId":null}},
    {"offset": {"line": 60, "column": 0}, "map": {"version":3,"sources":["file:///Users/daniilapet/Downloads/_next/lib/db.ts"],"sourcesContent":["export { prisma as db } from \"./prisma\"\n"],"names":[],"mappings":";AAAA","debugId":null}},
    {"offset": {"line": 88, "column": 0}, "map": {"version":3,"sources":["file:///Users/daniilapet/Downloads/_next/lib/jwt.ts"],"sourcesContent":["import { SignJWT, jwtVerify } from \"jose\"\n\nconst JWT_SECRET = new TextEncoder().encode(process.env.JWT_SECRET || \"your-secret-key-change-in-production\")\nconst JWT_EXPIRES_IN = \"7d\"\n\nexport interface JWTPayload {\n  userId: string\n  email: string\n  role: string\n}\n\nexport async function signToken(payload: JWTPayload): Promise<string> {\n  return await new SignJWT(payload)\n    .setProtectedHeader({ alg: \"HS256\" })\n    .setIssuedAt()\n    .setExpirationTime(JWT_EXPIRES_IN)\n    .sign(JWT_SECRET)\n}\n\nexport async function verifyToken(token: string): Promise<JWTPayload | null> {\n  try {\n    const { payload } = await jwtVerify(token, JWT_SECRET)\n    return payload as JWTPayload\n  } catch (error) {\n    return null\n  }\n}\n"],"names":[],"mappings":";;;;;;AAAA;AAAA;;AAEA,MAAM,aAAa,IAAI,cAAc,MAAM,CAAC,QAAQ,GAAG,CAAC,UAAU,IAAI;AACtE,MAAM,iBAAiB;AAQhB,eAAe,UAAU,OAAmB;IACjD,OAAO,MAAM,IAAI,kKAAO,CAAC,SACtB,kBAAkB,CAAC;QAAE,KAAK;IAAQ,GAClC,WAAW,GACX,iBAAiB,CAAC,gBAClB,IAAI,CAAC;AACV;AAEO,eAAe,YAAY,KAAa;IAC7C,IAAI;QACF,MAAM,EAAE,OAAO,EAAE,GAAG,MAAM,IAAA,sKAAS,EAAC,OAAO;QAC3C,OAAO;IACT,EAAE,OAAO,OAAO;QACd,OAAO;IACT;AACF","debugId":null}},
    {"offset": {"line": 116, "column": 0}, "map": {"version":3,"sources":["file:///Users/daniilapet/Downloads/_next/lib/auth-utils.ts"],"sourcesContent":["import bcrypt from \"bcryptjs\"\nimport { cookies } from \"next/headers\"\nimport { verifyToken, type JWTPayload } from \"./jwt\"\nimport { db } from \"./db\"\n\nconst SALT_ROUNDS = 10\n\nexport async function hashPassword(password: string): Promise<string> {\n  return bcrypt.hash(password, SALT_ROUNDS)\n}\n\nexport async function comparePassword(password: string, hash: string): Promise<boolean> {\n  return bcrypt.compare(password, hash)\n}\n\nexport async function getAuthUser(): Promise<JWTPayload | null> {\n  const cookieStore = await cookies()\n  const token = cookieStore.get(\"auth-token\")?.value\n\n  if (!token) return null\n\n  return verifyToken(token)\n}\n\nexport async function getUser() {\n  const authUser = await getAuthUser()\n  if (!authUser) return null\n\n  const user = await db.user.findUnique({\n    where: { id: authUser.userId },\n    include: { profile: true },\n  })\n\n  return user\n}\n\nexport async function setAuthCookie(token: string): Promise<void> {\n  const cookieStore = await cookies()\n  cookieStore.set(\"auth-token\", token, {\n    httpOnly: true,\n    secure: process.env.NODE_ENV === \"production\",\n    sameSite: \"lax\",\n    maxAge: 60 * 60 * 24 * 7, // 7 days\n    path: \"/\",\n  })\n}\n\nexport async function clearAuthCookie(): Promise<void> {\n  const cookieStore = await cookies()\n  cookieStore.delete(\"auth-token\")\n}\n"],"names":[],"mappings":";;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AAAA;;;;;AAEA,MAAM,cAAc;AAEb,eAAe,aAAa,QAAgB;IACjD,OAAO,8IAAM,CAAC,IAAI,CAAC,UAAU;AAC/B;AAEO,eAAe,gBAAgB,QAAgB,EAAE,IAAY;IAClE,OAAO,8IAAM,CAAC,OAAO,CAAC,UAAU;AAClC;AAEO,eAAe;IACpB,MAAM,cAAc,MAAM,IAAA,4IAAO;IACjC,MAAM,QAAQ,YAAY,GAAG,CAAC,eAAe;IAE7C,IAAI,CAAC,OAAO,OAAO;IAEnB,OAAO,IAAA,2HAAW,EAAC;AACrB;AAEO,eAAe;IACpB,MAAM,WAAW,MAAM;IACvB,IAAI,CAAC,UAAU,OAAO;IAEtB,MAAM,OAAO,MAAM,qJAAE,CAAC,IAAI,CAAC,UAAU,CAAC;QACpC,OAAO;YAAE,IAAI,SAAS,MAAM;QAAC;QAC7B,SAAS;YAAE,SAAS;QAAK;IAC3B;IAEA,OAAO;AACT;AAEO,eAAe,cAAc,KAAa;IAC/C,MAAM,cAAc,MAAM,IAAA,4IAAO;IACjC,YAAY,GAAG,CAAC,cAAc,OAAO;QACnC,UAAU;QACV,QAAQ,oDAAyB;QACjC,UAAU;QACV,QAAQ,KAAK,KAAK,KAAK;QACvB,MAAM;IACR;AACF;AAEO,eAAe;IACpB,MAAM,cAAc,MAAM,IAAA,4IAAO;IACjC,YAAY,MAAM,CAAC;AACrB","debugId":null}},
    {"offset": {"line": 183, "column": 0}, "map": {"version":3,"sources":["file:///Users/daniilapet/Downloads/_next/app/api/orders/route.ts"],"sourcesContent":["import { db } from \"@/lib/db\"\nimport { getAuthUser } from \"@/lib/auth-utils\"\nimport { NextResponse } from \"next/server\"\n\nexport async function GET() {\n  try {\n    const authUser = await getAuthUser()\n\n    if (!authUser) {\n      return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 })\n    }\n\n    const orders = await db.order.findMany({\n      where: { userId: authUser.userId },\n      include: { serverPlan: true },\n      orderBy: { createdAt: \"desc\" },\n    })\n\n    return NextResponse.json(orders)\n  } catch (error) {\n    console.error(\"[v0] Error fetching orders:\", error)\n    return NextResponse.json({ error: \"Failed to fetch orders\" }, { status: 500 })\n  }\n}\n\nexport async function POST(request: Request) {\n  try {\n    const authUser = await getAuthUser()\n\n    if (!authUser) {\n      return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 })\n    }\n\n    const body = await request.json()\n    const { server_plan_id, billing_period, server_name } = body\n\n    const plan = await db.serverPlan.findUnique({\n      where: { id: server_plan_id },\n    })\n\n    if (!plan) {\n      return NextResponse.json({ error: \"Server plan not found\" }, { status: 404 })\n    }\n\n    // Calculate price based on billing period (base: monthly price)\n    let pricePaid = plan.price\n    if (billing_period === \"quarterly\") {\n      pricePaid = plan.price * 3 * 0.95 // 5% discount\n    } else if (billing_period === \"yearly\") {\n      pricePaid = plan.price * 12 * 0.9 // 10% discount\n    }\n\n    // Calculate expiration date\n    const expiresAt = new Date()\n    if (billing_period === \"monthly\") {\n      expiresAt.setMonth(expiresAt.getMonth() + 1)\n    } else if (billing_period === \"quarterly\") {\n      expiresAt.setMonth(expiresAt.getMonth() + 3)\n    } else if (billing_period === \"yearly\") {\n      expiresAt.setFullYear(expiresAt.getFullYear() + 1)\n    }\n\n    // Получаем профиль пользователя\n    const profile = await db.profile.findUnique({ where: { userId: authUser.userId } })\n    if (!profile) {\n      return NextResponse.json({ error: \"Profile not found\" }, { status: 403 })\n    }\n    if (profile.balance < pricePaid) {\n      return NextResponse.json({ error: \"Недостаточно средств на балансе\" }, { status: 402 })\n    }\n\n    // Всё делаем в транзакции: списание, создание заказа, транзакция-история\n    const [order] = await db.$transaction([\n      db.profile.update({\n        where: { userId: authUser.userId },\n        data: { balance: { decrement: pricePaid } },\n      }),\n      db.order.create({\n        data: {\n          userId: authUser.userId,\n          serverPlanId: server_plan_id,\n          pricePaid,\n          billingPeriod: billing_period || \"monthly\",\n          serverName: server_name || `Server ${Date.now()}`,\n          status: \"active\",\n          expiresAt,\n        },\n      }),\n      db.transaction.create({\n        data: {\n          userId: authUser.userId,\n          amount: -pricePaid,\n          currency: \"USD\",\n          method: \"balance\",\n          status: \"completed\",\n          description: `Оплата сервера (${server_plan_id}) через баланс`,\n          type: \"purchase\"\n        },\n      }),\n    ])\n    return NextResponse.json(order)\n  } catch (error) {\n    console.error(\"[v0] Error creating order:\", error)\n    return NextResponse.json({ error: \"Failed to create order\" }, { status: 500 })\n  }\n}\n"],"names":[],"mappings":"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","debugId":null}}]
}