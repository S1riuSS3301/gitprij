{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 40, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/saefs/Downloads/vds-hub/vds-hub/lib/db.ts"],"sourcesContent":["type User = {\n  id: string\n  email: string\n  password: string\n  name: string | null\n  role: string\n  createdAt: Date\n  profile?: Profile\n}\n\ntype Profile = {\n  id: string\n  userId: string\n  balance: number\n  createdAt: Date\n}\n\ntype ServerPlan = {\n  id: string\n  name: string\n  nameRu: string\n  cpu: number\n  ram: number\n  storage: number\n  bandwidth: number\n  price: number\n  popular: boolean\n  description: string | null\n  createdAt: Date\n}\n\ntype Order = {\n  id: string\n  userId: string\n  serverPlanId: string\n  pricePaid: number\n  billingPeriod: string\n  serverName: string | null\n  status: string\n  expiresAt: Date\n  createdAt: Date\n  serverPlan?: ServerPlan\n}\n\ntype PromoCode = {\n  id: string\n  code: string\n  discount: number\n  type: \"percentage\" | \"fixed\"\n  maxUses: number\n  currentUses: number\n  expiresAt: string\n  active: boolean\n  createdAt: Date\n}\n\ntype Notification = {\n  id: string\n  title: string\n  message: string\n  createdAt: Date\n}\n\nclass MockDB {\n  private getItem<T>(key: string): T[] {\n    if (typeof window === \"undefined\") {\n      const g: any = globalThis as any\n      g.__mockdb = g.__mockdb || {}\n      const data = g.__mockdb[key]\n      return data ? (data as T[]) : []\n    }\n    const data = localStorage.getItem(key)\n    return data ? JSON.parse(data) : []\n  }\n\n  private setItem<T>(key: string, data: T[]): void {\n    if (typeof window === \"undefined\") {\n      const g: any = globalThis as any\n      g.__mockdb = g.__mockdb || {}\n      g.__mockdb[key] = data\n      return\n    }\n    localStorage.setItem(key, JSON.stringify(data))\n  }\n\n  // Initialize with default data\n  init() {\n    if (typeof window === \"undefined\") return\n\n    // Initialize server plans if not exists\n    const plans = this.getItem<ServerPlan>(\"serverPlans\")\n    if (plans.length === 0) {\n      const defaultPlans: ServerPlan[] = [\n        {\n          id: \"1\",\n          name: \"Starter\",\n          nameRu: \"Начальный\",\n          cpu: 2,\n          ram: 4,\n          storage: 80,\n          bandwidth: 4000,\n          price: 10, // USD per month\n          popular: false,\n          description: \"Идеально для небольших проектов\",\n          createdAt: new Date(),\n        },\n        {\n          id: \"2\",\n          name: \"Professional\",\n          nameRu: \"Профессиональный\",\n          cpu: 4,\n          ram: 8,\n          storage: 160,\n          bandwidth: 8000,\n          price: 20, // USD per month\n          popular: true,\n          description: \"Оптимальный выбор для бизнеса\",\n          createdAt: new Date(),\n        },\n        {\n          id: \"3\",\n          name: \"Enterprise\",\n          nameRu: \"Корпоративный\",\n          cpu: 8,\n          ram: 16,\n          storage: 320,\n          bandwidth: 16000,\n          price: 40, // USD per month\n          popular: false,\n          description: \"Максимальная производительность\",\n          createdAt: new Date(),\n        },\n      ]\n      this.setItem(\"serverPlans\", defaultPlans)\n    }\n\n    // Initialize users if not exists\n    const users = this.getItem<User>(\"users\")\n    if (users.length === 0) {\n      this.setItem(\"users\", [])\n    }\n\n    // Initialize profiles if not exists\n    const profiles = this.getItem<Profile>(\"profiles\")\n    if (profiles.length === 0) {\n      this.setItem(\"profiles\", [])\n    }\n\n    // Initialize orders if not exists\n    const orders = this.getItem<Order>(\"orders\")\n    if (orders.length === 0) {\n      this.setItem(\"orders\", [])\n    }\n\n    // Initialize promo codes if not exists\n    const promo = this.getItem<PromoCode>(\"promoCodes\")\n    if (promo.length === 0) {\n      this.setItem(\"promoCodes\", [])\n    }\n\n    // Initialize notifications if not exists\n    const notifs = this.getItem<Notification>(\"notifications\")\n    if (notifs.length === 0) {\n      this.setItem(\"notifications\", [])\n    }\n  }\n\n  user = {\n    findUnique: async ({\n      where,\n      include,\n    }: { where: { id?: string; email?: string }; include?: { profile?: boolean } }) => {\n      const users = this.getItem<User>(\"users\")\n      const user = users.find((u) => (where.id ? u.id === where.id : u.email === where.email))\n\n      if (user && include?.profile) {\n        const profiles = this.getItem<Profile>(\"profiles\")\n        user.profile = profiles.find((p) => p.userId === user!.id)\n      }\n\n      return user || null\n    },\n\n    create: async ({\n      data,\n    }: {\n      data: Omit<User, \"id\" | \"createdAt\" | \"role\"> & {\n        profile?: { create: Omit<Profile, \"id\" | \"userId\" | \"createdAt\"> }\n      }\n    }) => {\n      const users = this.getItem<User>(\"users\")\n      const newUser: User = {\n        id: Date.now().toString(),\n        email: data.email,\n        password: data.password,\n        name: data.name || null,\n        role: \"user\",\n        createdAt: new Date(),\n      }\n      users.push(newUser)\n      this.setItem(\"users\", users)\n\n      if (data.profile) {\n        const profiles = this.getItem<Profile>(\"profiles\")\n        const newProfile: Profile = {\n          id: Date.now().toString(),\n          userId: newUser.id,\n          balance: data.profile.create.balance,\n          createdAt: new Date(),\n        }\n        profiles.push(newProfile)\n        this.setItem(\"profiles\", profiles)\n      }\n\n      return newUser\n    },\n\n    update: async ({ where, data }: { where: { id: string }; data: Partial<User> }) => {\n      const users = this.getItem<User>(\"users\")\n      const idx = users.findIndex((u) => u.id === where.id)\n      if (idx === -1) return null\n      users[idx] = { ...users[idx], ...data }\n      this.setItem(\"users\", users)\n      return users[idx]\n    },\n\n    delete: async ({ where }: { where: { id: string } }) => {\n      const users = this.getItem<User>(\"users\")\n      const filtered = users.filter((u) => u.id !== where.id)\n      this.setItem(\"users\", filtered)\n      return { id: where.id }\n    },\n\n    findMany: async () => {\n      return this.getItem<User>(\"users\")\n    },\n  }\n\n  promoCode = {\n    findMany: async () => {\n      return this.getItem<PromoCode>(\"promoCodes\")\n    },\n\n    create: async ({ data }: { data: Omit<PromoCode, \"id\" | \"createdAt\" | \"currentUses\"> }) => {\n      const list = this.getItem<PromoCode>(\"promoCodes\")\n      const newItem: PromoCode = {\n        id: Date.now().toString(),\n        ...data,\n        currentUses: 0,\n        createdAt: new Date(),\n      }\n      list.push(newItem)\n      this.setItem(\"promoCodes\", list)\n      return newItem\n    },\n\n    delete: async ({ where }: { where: { id: string } }) => {\n      const list = this.getItem<PromoCode>(\"promoCodes\")\n      const filtered = list.filter((p) => p.id !== where.id)\n      this.setItem(\"promoCodes\", filtered)\n      return { id: where.id }\n    },\n\n    update: async ({ where, data }: { where: { id: string }; data: Partial<PromoCode> }) => {\n      const list = this.getItem<PromoCode>(\"promoCodes\")\n      const idx = list.findIndex((p) => p.id === where.id)\n      if (idx === -1) return null\n      list[idx] = { ...list[idx], ...data }\n      this.setItem(\"promoCodes\", list)\n      return list[idx]\n    },\n  }\n\n  notification = {\n    findMany: async () => {\n      return this.getItem<Notification>(\"notifications\")\n    },\n    create: async ({ data }: { data: Omit<Notification, \"id\" | \"createdAt\"> }) => {\n      const list = this.getItem<Notification>(\"notifications\")\n      const item: Notification = { id: Date.now().toString(), ...data, createdAt: new Date() }\n      list.unshift(item)\n      this.setItem(\"notifications\", list)\n      return item\n    },\n  }\n\n  profile = {\n    findUnique: async ({ where }: { where: { userId: string } }) => {\n      const profiles = this.getItem<Profile>(\"profiles\")\n      return profiles.find((p) => p.userId === where.userId) || null\n    },\n\n    create: async ({ data }: { data: Omit<Profile, \"id\" | \"createdAt\"> }) => {\n      const profiles = this.getItem<Profile>(\"profiles\")\n      const newProfile: Profile = {\n        id: Date.now().toString(),\n        userId: data.userId,\n        balance: data.balance,\n        createdAt: new Date(),\n      }\n      profiles.push(newProfile)\n      this.setItem(\"profiles\", profiles)\n      return newProfile\n    },\n\n    update: async ({ where, data }: { where: { userId: string }; data: Partial<Profile> }) => {\n      const profiles = this.getItem<Profile>(\"profiles\")\n      const index = profiles.findIndex((p) => p.userId === where.userId)\n      if (index !== -1) {\n        profiles[index] = { ...profiles[index], ...data }\n        this.setItem(\"profiles\", profiles)\n        return profiles[index]\n      }\n      return null\n    },\n  }\n\n  serverPlan = {\n    findMany: async () => {\n      return this.getItem<ServerPlan>(\"serverPlans\")\n    },\n\n    findUnique: async ({ where }: { where: { id: string } }) => {\n      const plans = this.getItem<ServerPlan>(\"serverPlans\")\n      return plans.find((p) => p.id === where.id) || null\n    },\n\n    create: async ({ data }: { data: Omit<ServerPlan, \"id\" | \"createdAt\"> }) => {\n      const plans = this.getItem<ServerPlan>(\"serverPlans\")\n      const newPlan: ServerPlan = {\n        id: Date.now().toString(),\n        ...data,\n        createdAt: new Date(),\n      }\n      plans.push(newPlan)\n      this.setItem(\"serverPlans\", plans)\n      return newPlan\n    },\n\n    update: async ({ where, data }: { where: { id: string }; data: Partial<ServerPlan> }) => {\n      const plans = this.getItem<ServerPlan>(\"serverPlans\")\n      const index = plans.findIndex((p) => p.id === where.id)\n      if (index !== -1) {\n        plans[index] = { ...plans[index], ...data }\n        this.setItem(\"serverPlans\", plans)\n        return plans[index]\n      }\n      return null\n    },\n\n    delete: async ({ where }: { where: { id: string } }) => {\n      const plans = this.getItem<ServerPlan>(\"serverPlans\")\n      const filtered = plans.filter((p) => p.id !== where.id)\n      this.setItem(\"serverPlans\", filtered)\n      return { id: where.id }\n    },\n  }\n\n  order = {\n    create: async ({ data }: { data: Omit<Order, \"id\" | \"createdAt\"> }) => {\n      const orders = this.getItem<Order>(\"orders\")\n      const newOrder: Order = {\n        id: Date.now().toString(),\n        ...data,\n        createdAt: new Date(),\n      }\n      orders.push(newOrder)\n      this.setItem(\"orders\", orders)\n      return newOrder\n    },\n\n    findMany: async ({\n      where,\n      include,\n      orderBy,\n    }: { where?: { userId?: string }; include?: { serverPlan?: boolean }; orderBy?: { createdAt: string } }) => {\n      let orders = this.getItem<Order>(\"orders\")\n\n      if (where?.userId) {\n        orders = orders.filter((o) => o.userId === where.userId)\n      }\n\n      if (include?.serverPlan) {\n        const plans = this.getItem<ServerPlan>(\"serverPlans\")\n        orders = orders.map((o) => ({\n          ...o,\n          serverPlan: plans.find((p) => p.id === o.serverPlanId),\n        }))\n      }\n\n      if (orderBy?.createdAt === \"desc\") {\n        orders.sort((a, b) => new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime())\n      }\n\n      return orders\n    },\n\n    findUnique: async ({ where }: { where: { id: string } }) => {\n      const orders = this.getItem<Order>(\"orders\")\n      return orders.find((o) => o.id === where.id) || null\n    },\n  }\n}\n\nexport const db = new MockDB()\n\n// Initialize default data and optional admin from env\ndb.init()\n\n// Seed admin user from env if provided\nconst ADMIN_EMAIL = process.env.ADMIN_EMAIL\nconst ADMIN_PASSWORD_HASH = process.env.ADMIN_PASSWORD_HASH\nconst ADMIN_NAME = process.env.ADMIN_NAME || \"Admin\"\n;(async () => {\n  try {\n    if (!ADMIN_EMAIL || !ADMIN_PASSWORD_HASH) return\n    const existing = await db.user.findUnique({ where: { email: ADMIN_EMAIL } })\n    if (existing) return\n    await db.user.create({\n      data: {\n        email: ADMIN_EMAIL,\n        password: ADMIN_PASSWORD_HASH,\n        name: ADMIN_NAME,\n        profile: { create: { balance: 0 } },\n      },\n    })\n    // Force role to admin\n    const users = (db as any).getItem?.(\"users\") || []\n    const idx = users.findIndex((u: any) => u.email === ADMIN_EMAIL)\n    if (idx !== -1) {\n      users[idx].role = \"admin\"\n      ;(db as any).setItem?.(\"users\", users)\n    }\n  } catch {}\n})()\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 354, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/saefs/Downloads/vds-hub/vds-hub/lib/jwt.ts"],"sourcesContent":["import { SignJWT, jwtVerify } from \"jose\"\n\nconst JWT_SECRET = new TextEncoder().encode(process.env.JWT_SECRET || \"your-secret-key-change-in-production\")\nconst JWT_EXPIRES_IN = \"7d\"\n\nexport interface JWTPayload {\n  userId: string\n  email: string\n  role: string\n}\n\nexport async function signToken(payload: JWTPayload): Promise<string> {\n  return await new SignJWT(payload)\n    .setProtectedHeader({ alg: \"HS256\" })\n    .setIssuedAt()\n    .setExpirationTime(JWT_EXPIRES_IN)\n    .sign(JWT_SECRET)\n}\n\nexport async function verifyToken(token: string): Promise<JWTPayload | null> {\n  try {\n    const { payload } = await jwtVerify(token, JWT_SECRET)\n    return payload as JWTPayload\n  } catch (error) {\n    return null\n  }\n}\n"],"names":[],"mappings":";;;;;;AAAA;AAAA;;AAEA,MAAM,aAAa,IAAI,cAAc,MAAM,CAAC,QAAQ,GAAG,CAAC,UAAU,IAAI;AACtE,MAAM,iBAAiB;AAQhB,eAAe,UAAU,OAAmB;IACjD,OAAO,MAAM,IAAI,2MAAO,CAAC,SACtB,kBAAkB,CAAC;QAAE,KAAK;IAAQ,GAClC,WAAW,GACX,iBAAiB,CAAC,gBAClB,IAAI,CAAC;AACV;AAEO,eAAe,YAAY,KAAa;IAC7C,IAAI;QACF,MAAM,EAAE,OAAO,EAAE,GAAG,MAAM,IAAA,+MAAS,EAAC,OAAO;QAC3C,OAAO;IACT,EAAE,OAAO,OAAO;QACd,OAAO;IACT;AACF","debugId":null}},
    {"offset": {"line": 382, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/saefs/Downloads/vds-hub/vds-hub/lib/auth-utils.ts"],"sourcesContent":["import bcrypt from \"bcryptjs\"\nimport { cookies } from \"next/headers\"\nimport { verifyToken, type JWTPayload } from \"./jwt\"\nimport { db } from \"./db\"\n\nconst SALT_ROUNDS = 10\n\nexport async function hashPassword(password: string): Promise<string> {\n  return bcrypt.hash(password, SALT_ROUNDS)\n}\n\nexport async function comparePassword(password: string, hash: string): Promise<boolean> {\n  return bcrypt.compare(password, hash)\n}\n\nexport async function getAuthUser(): Promise<JWTPayload | null> {\n  const cookieStore = await cookies()\n  const token = cookieStore.get(\"auth-token\")?.value\n\n  if (!token) return null\n\n  return verifyToken(token)\n}\n\nexport async function getUser() {\n  const authUser = await getAuthUser()\n  if (!authUser) return null\n\n  const user = await db.user.findUnique({\n    where: { id: authUser.userId },\n    include: { profile: true },\n  })\n\n  return user\n}\n\nexport async function setAuthCookie(token: string): Promise<void> {\n  const cookieStore = await cookies()\n  cookieStore.set(\"auth-token\", token, {\n    httpOnly: true,\n    secure: process.env.NODE_ENV === \"production\",\n    sameSite: \"lax\",\n    maxAge: 60 * 60 * 24 * 7, // 7 days\n    path: \"/\",\n  })\n}\n\nexport async function clearAuthCookie(): Promise<void> {\n  const cookieStore = await cookies()\n  cookieStore.delete(\"auth-token\")\n}\n"],"names":[],"mappings":";;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;;;;;AAEA,MAAM,cAAc;AAEb,eAAe,aAAa,QAAgB;IACjD,OAAO,uLAAM,CAAC,IAAI,CAAC,UAAU;AAC/B;AAEO,eAAe,gBAAgB,QAAgB,EAAE,IAAY;IAClE,OAAO,uLAAM,CAAC,OAAO,CAAC,UAAU;AAClC;AAEO,eAAe;IACpB,MAAM,cAAc,MAAM,IAAA,qLAAO;IACjC,MAAM,QAAQ,YAAY,GAAG,CAAC,eAAe;IAE7C,IAAI,CAAC,OAAO,OAAO;IAEnB,OAAO,IAAA,oKAAW,EAAC;AACrB;AAEO,eAAe;IACpB,MAAM,WAAW,MAAM;IACvB,IAAI,CAAC,UAAU,OAAO;IAEtB,MAAM,OAAO,MAAM,0JAAE,CAAC,IAAI,CAAC,UAAU,CAAC;QACpC,OAAO;YAAE,IAAI,SAAS,MAAM;QAAC;QAC7B,SAAS;YAAE,SAAS;QAAK;IAC3B;IAEA,OAAO;AACT;AAEO,eAAe,cAAc,KAAa;IAC/C,MAAM,cAAc,MAAM,IAAA,qLAAO;IACjC,YAAY,GAAG,CAAC,cAAc,OAAO;QACnC,UAAU;QACV,QAAQ,oDAAyB;QACjC,UAAU;QACV,QAAQ,KAAK,KAAK,KAAK;QACvB,MAAM;IACR;AACF;AAEO,eAAe;IACpB,MAAM,cAAc,MAAM,IAAA,qLAAO;IACjC,YAAY,MAAM,CAAC;AACrB","debugId":null}},
    {"offset": {"line": 448, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/saefs/Downloads/vds-hub/vds-hub/app/api/profile/route.ts"],"sourcesContent":["import { db } from \"@/lib/db\"\nimport { getAuthUser } from \"@/lib/auth-utils\"\nimport { NextResponse } from \"next/server\"\n\nexport async function GET() {\n  try {\n    const authUser = await getAuthUser()\n\n    if (!authUser) {\n      return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 })\n    }\n\n    let profile = await db.profile.findUnique({ where: { userId: authUser.userId } })\n\n    if (!profile) {\n      // Автосоздание профиля, если отсутствует\n      profile = await db.profile.create({ data: { userId: authUser.userId, balance: 0 } })\n    }\n\n    return NextResponse.json(profile)\n  } catch (error) {\n    console.error(\"[v0] Error fetching profile:\", error)\n    return NextResponse.json({ error: \"Failed to fetch profile\" }, { status: 500 })\n  }\n}\n\nexport async function PATCH(request: Request) {\n  try {\n    const authUser = await getAuthUser()\n\n    if (!authUser) {\n      return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 })\n    }\n\n    const body = await request.json()\n\n    const profile = await db.profile.update({\n      where: { userId: authUser.userId },\n      data: body,\n    })\n\n    return NextResponse.json(profile)\n  } catch (error) {\n    console.error(\"[v0] Error updating profile:\", error)\n    return NextResponse.json({ error: \"Failed to update profile\" }, { status: 500 })\n  }\n}\n"],"names":[],"mappings":";;;;;;AAAA;AACA;AACA;;;;AAEO,eAAe;IACpB,IAAI;QACF,MAAM,WAAW,MAAM,IAAA,8KAAW;QAElC,IAAI,CAAC,UAAU;YACb,OAAO,yLAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAe,GAAG;gBAAE,QAAQ;YAAI;QACpE;QAEA,IAAI,UAAU,MAAM,0JAAE,CAAC,OAAO,CAAC,UAAU,CAAC;YAAE,OAAO;gBAAE,QAAQ,SAAS,MAAM;YAAC;QAAE;QAE/E,IAAI,CAAC,SAAS;YACZ,yCAAyC;YACzC,UAAU,MAAM,0JAAE,CAAC,OAAO,CAAC,MAAM,CAAC;gBAAE,MAAM;oBAAE,QAAQ,SAAS,MAAM;oBAAE,SAAS;gBAAE;YAAE;QACpF;QAEA,OAAO,yLAAY,CAAC,IAAI,CAAC;IAC3B,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,gCAAgC;QAC9C,OAAO,yLAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAA0B,GAAG;YAAE,QAAQ;QAAI;IAC/E;AACF;AAEO,eAAe,MAAM,OAAgB;IAC1C,IAAI;QACF,MAAM,WAAW,MAAM,IAAA,8KAAW;QAElC,IAAI,CAAC,UAAU;YACb,OAAO,yLAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAe,GAAG;gBAAE,QAAQ;YAAI;QACpE;QAEA,MAAM,OAAO,MAAM,QAAQ,IAAI;QAE/B,MAAM,UAAU,MAAM,0JAAE,CAAC,OAAO,CAAC,MAAM,CAAC;YACtC,OAAO;gBAAE,QAAQ,SAAS,MAAM;YAAC;YACjC,MAAM;QACR;QAEA,OAAO,yLAAY,CAAC,IAAI,CAAC;IAC3B,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,gCAAgC;QAC9C,OAAO,yLAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAA2B,GAAG;YAAE,QAAQ;QAAI;IAChF;AACF","debugId":null}}]
}