{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/saefs/Downloads/vds-hub/vds-hub/lib/prisma.ts"],"sourcesContent":["import { PrismaClient } from \"@prisma/client\"\r\n\r\ndeclare global {\r\n  // eslint-disable-next-line no-var\r\n  var prisma: PrismaClient | undefined\r\n}\r\n\r\nexport const prisma: PrismaClient = global.prisma ?? new PrismaClient()\r\n\r\nif (process.env.NODE_ENV !== \"production\") {\r\n  global.prisma = prisma\r\n}\r\n\r\n\r\n"],"names":[],"mappings":";;;;AAAA;;AAOO,MAAM,SAAuB,OAAO,MAAM,IAAI,IAAI,6IAAY;AAErE,wCAA2C;IACzC,OAAO,MAAM,GAAG;AAClB","debugId":null}},
    {"offset": {"line": 66, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/saefs/Downloads/vds-hub/vds-hub/app/api/lzt/create/route.ts"],"sourcesContent":["import { NextResponse } from 'next/server'\r\nimport { prisma } from '@/lib/prisma'\r\n\r\nexport async function POST(request: Request) {\r\n  try {\r\n    const { amount, description, userId, currency = \"USD\", lifetime = 60 } = await request.json();\r\n\r\n    const auth_login = process.env.AUTH_LOGIN\r\n    const auth_secret = process.env.AUTH_SECRET\r\n    let redirect_url = process.env.REDIRECT_URL || \"localhost:3000/dashboard/billing\"\r\n\r\n    if (!auth_login || !auth_secret) {\r\n      return NextResponse.json({ error: 'Отсутствуют credentials CrystalPay' }, { status: 500 })\r\n    }\r\n\r\n    if (!redirect_url.startsWith(\"http\")) redirect_url = `https://${redirect_url.replace(/^\\/+/, \"\")}`\r\n    redirect_url += '?tx=1';  // Append to trigger polling on redirect\r\n\r\n    const parsedAmount = Number.parseFloat(amount)\r\n    if (isNaN(parsedAmount) || parsedAmount < 10) {\r\n      return NextResponse.json({ error: 'Минимальная сумма: $10.00 USD' }, { status: 400 })\r\n    }\r\n\r\n    const payload = {\r\n      auth_login,\r\n      auth_secret,\r\n      amount: Number(parsedAmount.toFixed(2)),\r\n      lifetime: 60,\r\n      type: \"topup\",\r\n      currency: \"USD\",\r\n      description: description || \"Пополнение баланса (CrystalPay)\",\r\n      extra: `userId:${userId}`,\r\n      redirect_url,\r\n    }\r\n\r\n    console.log('Payload:', payload)\r\n\r\n    const res = await fetch(\"https://api.crystalpay.io/v3/invoice/create/\", {\r\n      method: \"POST\",\r\n      headers: { \"Content-Type\": \"application/json\" },\r\n      body: JSON.stringify(payload),\r\n    })\r\n\r\n    const data = await res.json()\r\n    console.log('CrystalPay:', data)\r\n\r\n    if (!res.ok || data.error) {\r\n      const msg = data.errors?.join(\", \") || data.error || \"Ошибка CrystalPay\"\r\n      return NextResponse.json({ error: msg }, { status: 400 })\r\n    }\r\n\r\n    await prisma.transaction.create({\r\n      data: {\r\n        userId,\r\n        amount: Number(data.amount ?? payload.amount),\r\n        currency: data.currency ?? currency,\r\n        method: 'crystalpay',\r\n        status: 'pending',\r\n        externalId: String(data.id),\r\n        type: 'topup',\r\n      },\r\n    })\r\n\r\n    return NextResponse.json({\r\n      url: data.url,\r\n      id: data.id,\r\n    })\r\n  } catch (err: any) {\r\n    console.error('Error:', err)\r\n    return NextResponse.json({ error: err.message }, { status: 500 })\r\n  }\r\n}"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEO,eAAe,KAAK,OAAgB;IACzC,IAAI;QACF,MAAM,EAAE,MAAM,EAAE,WAAW,EAAE,MAAM,EAAE,WAAW,KAAK,EAAE,WAAW,EAAE,EAAE,GAAG,MAAM,QAAQ,IAAI;QAE3F,MAAM,aAAa,QAAQ,GAAG,CAAC,UAAU;QACzC,MAAM,cAAc,QAAQ,GAAG,CAAC,WAAW;QAC3C,IAAI,eAAe,QAAQ,GAAG,CAAC,YAAY,IAAI;QAE/C,IAAI,CAAC,cAAc,CAAC,aAAa;YAC/B,OAAO,yLAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAqC,GAAG;gBAAE,QAAQ;YAAI;QAC1F;QAEA,IAAI,CAAC,aAAa,UAAU,CAAC,SAAS,eAAe,CAAC,QAAQ,EAAE,aAAa,OAAO,CAAC,QAAQ,KAAK;QAClG,gBAAgB,SAAU,wCAAwC;QAElE,MAAM,eAAe,OAAO,UAAU,CAAC;QACvC,IAAI,MAAM,iBAAiB,eAAe,IAAI;YAC5C,OAAO,yLAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAgC,GAAG;gBAAE,QAAQ;YAAI;QACrF;QAEA,MAAM,UAAU;YACd;YACA;YACA,QAAQ,OAAO,aAAa,OAAO,CAAC;YACpC,UAAU;YACV,MAAM;YACN,UAAU;YACV,aAAa,eAAe;YAC5B,OAAO,CAAC,OAAO,EAAE,QAAQ;YACzB;QACF;QAEA,QAAQ,GAAG,CAAC,YAAY;QAExB,MAAM,MAAM,MAAM,MAAM,gDAAgD;YACtE,QAAQ;YACR,SAAS;gBAAE,gBAAgB;YAAmB;YAC9C,MAAM,KAAK,SAAS,CAAC;QACvB;QAEA,MAAM,OAAO,MAAM,IAAI,IAAI;QAC3B,QAAQ,GAAG,CAAC,eAAe;QAE3B,IAAI,CAAC,IAAI,EAAE,IAAI,KAAK,KAAK,EAAE;YACzB,MAAM,MAAM,KAAK,MAAM,EAAE,KAAK,SAAS,KAAK,KAAK,IAAI;YACrD,OAAO,yLAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAI,GAAG;gBAAE,QAAQ;YAAI;QACzD;QAEA,MAAM,kKAAM,CAAC,WAAW,CAAC,MAAM,CAAC;YAC9B,MAAM;gBACJ;gBACA,QAAQ,OAAO,KAAK,MAAM,IAAI,QAAQ,MAAM;gBAC5C,UAAU,KAAK,QAAQ,IAAI;gBAC3B,QAAQ;gBACR,QAAQ;gBACR,YAAY,OAAO,KAAK,EAAE;gBAC1B,MAAM;YACR;QACF;QAEA,OAAO,yLAAY,CAAC,IAAI,CAAC;YACvB,KAAK,KAAK,GAAG;YACb,IAAI,KAAK,EAAE;QACb;IACF,EAAE,OAAO,KAAU;QACjB,QAAQ,KAAK,CAAC,UAAU;QACxB,OAAO,yLAAY,CAAC,IAAI,CAAC;YAAE,OAAO,IAAI,OAAO;QAAC,GAAG;YAAE,QAAQ;QAAI;IACjE;AACF","debugId":null}}]
}