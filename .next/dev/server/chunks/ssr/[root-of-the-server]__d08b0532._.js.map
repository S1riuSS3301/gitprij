{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 10, "column": 0}, "map": {"version":3,"sources":["file:///root/gitprij/lib/prisma.ts"],"sourcesContent":["import { PrismaClient } from \"@prisma/client\"\n\ndeclare global {\n  // eslint-disable-next-line no-var\n  var prisma: PrismaClient | undefined\n}\n\nexport const prisma: PrismaClient = global.prisma ?? new PrismaClient()\n\nif (process.env.NODE_ENV !== \"production\") {\n  global.prisma = prisma\n}\n\n\n"],"names":[],"mappings":";;;;AAAA;;AAOO,MAAM,SAAuB,OAAO,MAAM,IAAI,IAAI,6IAAY;AAErE,wCAA2C;IACzC,OAAO,MAAM,GAAG;AAClB","debugId":null}},
    {"offset": {"line": 24, "column": 0}, "map": {"version":3,"sources":["file:///root/gitprij/lib/db.ts"],"sourcesContent":["export { prisma as db } from \"./prisma\"\n"],"names":[],"mappings":";AAAA","debugId":null}},
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///root/gitprij/lib/jwt.ts"],"sourcesContent":["import { SignJWT, jwtVerify } from \"jose\"\n\nconst JWT_SECRET = new TextEncoder().encode(process.env.JWT_SECRET || \"your-secret-key-change-in-production\")\nconst JWT_EXPIRES_IN = \"7d\"\n\nexport interface JWTPayload {\n  userId: string\n  email: string\n  role: string\n}\n\nexport async function signToken(payload: JWTPayload): Promise<string> {\n  return await new SignJWT(payload)\n    .setProtectedHeader({ alg: \"HS256\" })\n    .setIssuedAt()\n    .setExpirationTime(JWT_EXPIRES_IN)\n    .sign(JWT_SECRET)\n}\n\nexport async function verifyToken(token: string): Promise<JWTPayload | null> {\n  try {\n    const { payload } = await jwtVerify(token, JWT_SECRET)\n    return payload as JWTPayload\n  } catch (error) {\n    return null\n  }\n}\n"],"names":[],"mappings":";;;;;;AAAA;AAAA;;AAEA,MAAM,aAAa,IAAI,cAAc,MAAM,CAAC,QAAQ,GAAG,CAAC,UAAU,IAAI;AACtE,MAAM,iBAAiB;AAQhB,eAAe,UAAU,OAAmB;IACjD,OAAO,MAAM,IAAI,gKAAO,CAAC,SACtB,kBAAkB,CAAC;QAAE,KAAK;IAAQ,GAClC,WAAW,GACX,iBAAiB,CAAC,gBAClB,IAAI,CAAC;AACV;AAEO,eAAe,YAAY,KAAa;IAC7C,IAAI;QACF,MAAM,EAAE,OAAO,EAAE,GAAG,MAAM,IAAA,oKAAS,EAAC,OAAO;QAC3C,OAAO;IACT,EAAE,OAAO,OAAO;QACd,OAAO;IACT;AACF","debugId":null}},
    {"offset": {"line": 74, "column": 0}, "map": {"version":3,"sources":["file:///root/gitprij/lib/auth-utils.ts"],"sourcesContent":["import bcrypt from \"bcryptjs\"\nimport { cookies } from \"next/headers\"\nimport { verifyToken, type JWTPayload } from \"./jwt\"\nimport { db } from \"./db\"\n\nconst SALT_ROUNDS = 10\n\nexport async function hashPassword(password: string): Promise<string> {\n  return bcrypt.hash(password, SALT_ROUNDS)\n}\n\nexport async function comparePassword(password: string, hash: string): Promise<boolean> {\n  return bcrypt.compare(password, hash)\n}\n\nexport async function getAuthUser(): Promise<JWTPayload | null> {\n  const cookieStore = await cookies()\n  const token = cookieStore.get(\"auth-token\")?.value\n\n  if (!token) return null\n\n  return verifyToken(token)\n}\n\nexport async function getUser() {\n  const authUser = await getAuthUser()\n  if (!authUser) return null\n\n  const user = await db.user.findUnique({\n    where: { id: authUser.userId },\n    include: { profile: true },\n  })\n\n  return user\n}\n\nexport async function setAuthCookie(token: string): Promise<void> {\n  const cookieStore = await cookies()\n  cookieStore.set(\"auth-token\", token, {\n    httpOnly: true,\n    secure: process.env.NODE_ENV === \"production\",\n    sameSite: \"lax\",\n    maxAge: 60 * 60 * 24 * 7, // 7 days\n    path: \"/\",\n  })\n}\n\nexport async function clearAuthCookie(): Promise<void> {\n  const cookieStore = await cookies()\n  cookieStore.delete(\"auth-token\")\n}\n"],"names":[],"mappings":";;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AAAA;;;;;AAEA,MAAM,cAAc;AAEb,eAAe,aAAa,QAAgB;IACjD,OAAO,4IAAM,CAAC,IAAI,CAAC,UAAU;AAC/B;AAEO,eAAe,gBAAgB,QAAgB,EAAE,IAAY;IAClE,OAAO,4IAAM,CAAC,OAAO,CAAC,UAAU;AAClC;AAEO,eAAe;IACpB,MAAM,cAAc,MAAM,IAAA,0IAAO;IACjC,MAAM,QAAQ,YAAY,GAAG,CAAC,eAAe;IAE7C,IAAI,CAAC,OAAO,OAAO;IAEnB,OAAO,IAAA,yHAAW,EAAC;AACrB;AAEO,eAAe;IACpB,MAAM,WAAW,MAAM;IACvB,IAAI,CAAC,UAAU,OAAO;IAEtB,MAAM,OAAO,MAAM,mJAAE,CAAC,IAAI,CAAC,UAAU,CAAC;QACpC,OAAO;YAAE,IAAI,SAAS,MAAM;QAAC;QAC7B,SAAS;YAAE,SAAS;QAAK;IAC3B;IAEA,OAAO;AACT;AAEO,eAAe,cAAc,KAAa;IAC/C,MAAM,cAAc,MAAM,IAAA,0IAAO;IACjC,YAAY,GAAG,CAAC,cAAc,OAAO;QACnC,UAAU;QACV,QAAQ,oDAAyB;QACjC,UAAU;QACV,QAAQ,KAAK,KAAK,KAAK;QACvB,MAAM;IACR;AACF;AAEO,eAAe;IACpB,MAAM,cAAc,MAAM,IAAA,0IAAO;IACjC,YAAY,MAAM,CAAC;AACrB","debugId":null}},
    {"offset": {"line": 147, "column": 0}, "map": {"version":3,"sources":["file:///root/gitprij/lib/resend.ts"],"sourcesContent":["import { Resend } from 'resend'\n\nconst resend = process.env.RESEND_API_KEY ? new Resend(process.env.RESEND_API_KEY) : null\n\nexport { resend }\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,SAAS,QAAQ,GAAG,CAAC,cAAc,GAAG,IAAI,kJAAM,CAAC,QAAQ,GAAG,CAAC,cAAc,IAAI","debugId":null}},
    {"offset": {"line": 159, "column": 0}, "map": {"version":3,"sources":["file:///root/gitprij/lib/actions/auth.ts"],"sourcesContent":["\"use server\"\n\nimport { db } from \"@/lib/db\"\nimport { hashPassword, comparePassword, setAuthCookie, clearAuthCookie, getAuthUser } from \"@/lib/auth-utils\"\nimport { signToken } from \"@/lib/jwt\"\nimport { revalidatePath } from \"next/cache\"\nimport { redirect } from \"next/navigation\"\nimport { resend } from \"@/lib/resend\"\nimport { headers } from \"next/headers\"\n\nexport async function signIn(email: string, password: string) {\n  try {\n    const user = await db.user.findUnique({\n      where: { email },\n      include: { profile: true },\n    })\n\n    if (!user) {\n      return { error: \"Неверный email или пароль\" }\n    }\n\n    const isValid = await comparePassword(password, user.password)\n    if (!isValid) {\n      return { error: \"Неверный email или пароль\" }\n    }\n\n    const token = await signToken({\n      userId: user.id,\n      email: user.email,\n      role: user.role,\n    })\n\n    await setAuthCookie(token)\n\n    // Log login\n    const headersList = await headers()\n    await db.log.create({\n      data: {\n        userId: user.id,\n        action: \"login\",\n        details: \"User logged in\",\n        ip: headersList.get(\"x-forwarded-for\") || headersList.get(\"x-real-ip\") || \"unknown\",\n        userAgent: headersList.get(\"user-agent\") || \"unknown\"\n      }\n    })\n\n    return { success: true }\n  } catch (error) {\n    console.error(\"[v0] Sign in error:\", error)\n    return { error: \"Ошибка входа\" }\n  }\n}\n\nexport async function signUp(email: string, password: string, name?: string, referralCode?: string) {\n  try {\n    const existingUser = await db.user.findUnique({\n      where: { email },\n    })\n\n    if (existingUser) {\n      return { error: \"Пользователь с таким email уже существует\" }\n    }\n\n    const hashedPassword = await hashPassword(password)\n    \n    // Генерируем уникальный реферальный код\n    const userReferralCode = Math.random().toString(36).substring(2, 10).toUpperCase()\n    \n    // Проверяем реферальный код если указан\n    let referrerId: string | undefined\n    if (referralCode) {\n      const referrer = await db.user.findUnique({\n        where: { referralCode },\n      })\n      if (referrer) {\n        referrerId = referrer.id\n      }\n    }\n\n    const user = await db.user.create({\n      data: {\n        email,\n        password: hashedPassword,\n        name,\n        referralCode: userReferralCode,\n        referredBy: referrerId,\n        profile: {\n          create: {\n            balance: 0,\n          },\n        },\n      },\n    })\n\n    // Создаем запись о реферале если есть реферер\n    if (referrerId) {\n      await db.referral.create({\n        data: {\n          referrerId,\n          referredId: user.id,\n          earnings: 0,\n        },\n      })\n    }\n\n    const token = await signToken({\n      userId: user.id,\n      email: user.email,\n      role: user.role,\n    })\n\n    await setAuthCookie(token)\n\n    // Log registration\n    const headersList = await headers()\n    await db.log.create({\n      data: {\n        userId: user.id,\n        action: \"register\",\n        details: `User registered with email ${user.email}`,\n        ip: headersList.get(\"x-forwarded-for\") || headersList.get(\"x-real-ip\") || \"unknown\",\n        userAgent: headersList.get(\"user-agent\") || \"unknown\"\n      }\n    })\n\n    // Send confirmation email\n    try {\n      await resend.emails.send({\n        from: \"noreply@vds-hub.com\",\n        to: user.email,\n        subject: \"Welcome to VDS Hub!\",\n        html: `\n          <h1>Welcome to VDS Hub, ${user.name || 'User'}!</h1>\n          <p>Thank you for registering. Your account has been created successfully.</p>\n          <p>You can now log in and start using our VDS services.</p>\n          <br>\n          <p>Best regards,<br>VDS Hub Team</p>\n        `\n      })\n    } catch (emailError) {\n      console.error(\"Failed to send confirmation email:\", emailError)\n      // Don't fail registration if email fails\n    }\n\n    return { success: true }\n  } catch (error) {\n    console.error(\"[v0] Sign up error:\", error)\n    return { error: \"Ошибка регистрации\" }\n  }\n}\n\nexport async function signOut() {\n  await clearAuthCookie()\n  revalidatePath(\"/\", \"layout\")\n  redirect(\"/\")\n}\n\nexport async function getUser() {\n  const authUser = await getAuthUser()\n  if (!authUser) return null\n\n  const user = await db.user.findUnique({\n    where: { id: authUser.userId },\n    include: { profile: true },\n  })\n\n  return user\n}\n\nexport async function getUserProfile() {\n  const authUser = await getAuthUser()\n  if (!authUser) return null\n\n  const profile = await db.profile.findUnique({\n    where: { userId: authUser.userId },\n  })\n\n  return profile\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 379, "column": 0}, "map": {"version":3,"sources":["file:///root/gitprij/.next-internal/server/app/%5Blocale%5D/dashboard/support/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["export {signIn as '60e8f0b7e21b6bbbad7922de001eaf79883b32971e'} from 'ACTIONS_MODULE0'\nexport {signOut as '008ff62aa6bf6c8cbb7222e7c12c009d3713f678af'} from 'ACTIONS_MODULE0'\nexport {signUp as '785c45f17123f8497ecb33c7dc2eaed1e528347ce9'} from 'ACTIONS_MODULE0'\n"],"names":[],"mappings":";AAAA","debugId":null}}]
}