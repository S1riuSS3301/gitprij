# План реализации сайта VDS_HUB

## Обзор
Полная доработка Next.js приложения для продажи VDS серверов. Основные задачи: фикс багов, админка, платежи (DV.net, lolz, platega.io, crypto bot), интеграция VMmanager, безопасность, почта, дополнительные фичи.

**Общий срок:** 4-6 недель  
**Команда:** 1-2 бэкендера, 1 фронтендер  
**Приоритеты:** Высокий (критично), Средний (важно), Низкий (дополнительно)

## 1. Фикс багов и тестирование (Высокий приоритет, 1 неделя)
- [x] Протестировать все страницы на ошибки (главная, регистрация, дашборд, админка)
- [x] Исправить JavaScript ошибки в браузере
- [x] Проверить API эндпоинты на корректность ответов
- [x] Фикс UI багов (адаптивность, фиолетовый дизайн)
- [x] Тестирование форм (регистрация, логин, покупка)
- [x] Проверить базу данных (Prisma migrations, данные)
- [x] Фикс конфигуратора серверов (динамическая загрузка планов)

## 2. Админка (Высокий приоритет, 2 недели)
### Страницы и UI
- [x] Доработать AdminSidebar (все разделы: пользователи, серверы, платежи, рефералы, промокоды, рассылки)
- [x] Реализовать AdminStatsCards (заказы, доходы, пользователи)
- [x] RecentUsers и RecentPayments компоненты
- [x] Страница управления пользователями (/admin/users)
- [x] Страница управления серверами (/admin/servers)
- [x] Страница платежей (/admin/payments)
- [x] Страница рефералов (/admin/referrals)
- [x] Страница промокодов (/admin/promo-codes)
- [x] Страница уведомлений/рассылок (/admin/notifications)

### API и логика
- [x] API для пользователей: список, поиск по ID/email, бан/разбан (по IP, с выкидыванием из аккаунта)
- [x] API для проверки пользователя: IP, ранг, баланс, сумма пополнений, активные серверы
- [x] API для серверов: выдача/удаление по ID/email, изменение статуса
- [x] API для платежей: история, комиссии, настройки
- [x] API для рефералов: статистика, управление
- [x] API для промокодов: создание/удаление
- [x] API для рассылок: email и на сайт
- [x] Настройки цен/комиссий в админке
- [x] Ранги пользователей (Пользователь, Менеджер, Администратор)

## 3. Платежные системы (Высокий приоритет, 3 недели)
### DV.net (замена crystalpay)
- [x] Изучить документацию https://docs.dv.net/ru/integration/webhooks.html
- [x] Настроить API клиент для DV.net
- [x] Реализовать webhooks для подтверждения платежей
- [x] Интеграция крипты (USDT, BTC и т.д.) с 5% комиссией

### Platega.io
- [x] API интеграция для фиата (СБП, карты)
- [x] Минимальная сумма 100р (снижено с 1000р)
- [x] Авто-подтверждение платежей

### Crypto Bot
- [x] Интеграция для крипты
- [x] Система с рандомом (прибавка 0.01-1$ для идентификации платежей)

### Lolz
- [x] Интеграция платежной системы lolz

### Общие платежи
- [x] Пополнение баланса через все системы
- [x] Только месячная оплата дедиков
- [x] Авто-выдача сервера после оплаты
- [x] История транзакций в профиле
- [x] Комиссии: крипта 5%, фиат через patega.io

## 4. Интеграция VMmanager (Высокий приоритет, 3 недели)
- [x] Базовая интеграция VMmanager (API для создания/управления серверами)
- [x] Изучить API VMmanager (с лицензией) - реализованы основные endpoints
- [x] Настроить подключение к панели (env переменные для URL, API key, cluster)
- [x] Авто-создание сервера после оплаты
- [x] Выбор ОС из панели при покупке (GET /os)
- [x] Галочка установки Python (выбор версии: 3.8, 3.9, 3.10, 3.11)
- [x] Галочка установки Google (вероятно Google Cloud SDK)
- [x] Управление сервером: перезагрузка, отключение/включение
- [x] Смена пароля, ОС, повышение тарифа (готово для расширения)
- [ ] Интеграция с Hetzner (дополнительно, если нужно)

## 5. Безопасность (Средний приоритет, 1 неделя)
- [x] Добавить CAPTCHA на регистрацию/логин (Cloudflare Turnstile)
- [ ] Защита от DDoS (Cloudflare или аналог)
- [ ] SSL сертификат
- [x] Защита от SQL-инъекций, XSS (через Prisma ORM)
- [x] Валидация вводимых данных
- [x] Логирование: вход на сайт (IP), регистрация, пополнение баланса, покупка сервера

## 6. Почтовая система (Средний приоритет, 1 неделя)
- [x] Настроить Resend для отправки email
- [x] Письмо подтверждения регистрации
- [x] Письмо сброса пароля (forgot-password)
- [x] Письмо при покупке дедика: IP, пароль, specs (ядра, RAM, диск), ОС
- [x] Настройки SMTP/Resend в .env

## 7. Дополнительные фичи (Средний/Низкий приоритет, 2 недели)
### Личный кабинет
- [ ] Баланс пользователя, история платежей
- [ ] Список серверов с статусом, продлением
- [ ] Управление сервером (из VMmanager)
- [ ] Реферальная система: промокоды/ссылки, 5% бонус, вывод от 10$

### Поддержка
- [ ] Чат на сайте (Socket.io или внешний)
- [ ] Интеграция TG бота для уведомлений
- [ ] Кнопки: чат + TG поддержка/новости

### Многоязычность
- [ ] Переключатель RU/EN в header
- [ ] Файлы переводов (locales)
- [ ] Обновление всех текстов

### Другое
- [ ] FAQ страница
- [ ] Тикеты поддержки
- [ ] Уведомления в браузере
- [ ] Иконка TG новостей справа

## 8. Развертывание и тестирование (Низкий приоритет, 1 неделя)
- [ ] Использовать скрипт для EC2:
  - Ubuntu, Node.js 18, PM2
  - Git clone проекта
  - npm install, build, start
- [ ] Тестирование на баги
- [ ] Документация по админке
- [ ] Финальное тестирование платежей и авто-выдачи

## Риски и зависимости
- Доступ к API VMmanager, платежных систем
- Тестирование на реальных серверах
- Синхронизация с заказчиком по деталям (например, Google установка)

## Контроль качества
- Еженедельные демо для заказчика
- Автотесты для API
- Ручное тестирование UI/UX
